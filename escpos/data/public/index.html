<!DOCTYPE html>
<html><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<style>
textarea{width:100%;height:32ex;resize:none;}
	</style>
</head><body>
	<h1>esp-tp</h1>
	<hr>

	<textarea id="txt"></textarea><br>
	<button id="trun">send txt</button><br>
	<hr>
	<label>img:<input type="file" id="img"></label><br>
	<label>rotate:<input type="range" id="irotate" min="-4" max="4"></label><br>
	<label>scale:<input type="range" id="iscale" min="0" max="1" step="0.25" value="1"></label><br>
	<button id="irun">send img</button>
	<script type="module">
		import{WSPrint}from'./wsprint.mjs';
		import{txt2bin}from'./txt2bin.mjs';
		import{img2bin}from'./img2bin.mjs';

		self.ws=new WSPrint('/ws').open();

		trun.onclick=_=>ws.send(txt2bin(txt.value));

		iscale.onchange=({target:e})=>+e.value||(e.value=e.step);
		irun.onclick=_=>[...img.files].map(async x=>(
			x=await new Promise((f,r)=>Object.assign(new Image(),{
				src:URL.createObjectURL(x),
				onload:({target:x})=>f(x),onerror:r
			})),
			URL.revokeObjectURL(x.src),
			
			ws.send(img2bin({
				genctx:(w,h)=>new OffscreenCanvas(w,h).getContext('2d'),
				// genctx:(w,h)=>(c=>(
				// 	Object.assign(c,{width:w,height:h}),
				// 	document.body.append(c),
				// 	c.getContext('2d')
				// ))(document.createElement('canvas')),
				img:x,
				transform:{rotate:Math.PI/4*irotate.value,scale:iscale.value}
			}))
		))
	</script>
</body></html>
